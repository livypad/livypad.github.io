<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>笔记：Distributed Systems An Algorithmic Approach 2nd | zhh's blog</title><meta name=keywords content="教程,读书笔记"><meta name=description content="Ghosh, Sukumar (2014) - Distributed Systems An Algorithmic Approach Ch 1 introduction Ch 2 interprocess communication naming rpc remote procedure call cloud computing MapReduce ch 3 Models for Communication shared variable 共享变量 linda mobile agent 模型强弱 resequencing protocol, 非 FIFO 模拟 FIFO 共享变量模拟信息传递 信息传递模拟共享变量 信"><meta name=author content="livypad"><link rel=canonical href=https://livypad.github.io/post/2022-07-09-ghoshdsaaa/><link crossorigin=anonymous href=/assets/css/stylesheet.min.7ca4c3dd9394a71fbe69a066b9fbc3dcfe7fb50ce978b051497ffe24c8e1c49a.css integrity="sha256-fKTD3ZOUpx++aaBmufvD3P5/tQzpeLBRSX/+JMjhxJo=" rel="preload stylesheet" as=style><link rel=icon href=https://livypad.github.io/favicon.ico><link rel=apple-touch-icon href=https://livypad.github.io/apple-touch-icon.png><meta name=twitter:title content="笔记：Distributed Systems An Algorithmic Approach 2nd | zhh's blog"><meta name=twitter:description content="Ghosh, Sukumar (2014) - Distributed Systems An Algorithmic Approach Ch 1 introduction Ch 2 interprocess communication naming rpc remote procedure call cloud computing MapReduce ch 3 Models for Communication shared variable 共享变量 linda mobile agent 模型强弱 resequencing protocol, 非 FIFO 模拟 FIFO 共享变量模拟信息传递 信息传递模拟共享变量 信"><meta name=twitter:site content="@novoreorx"><meta name=twitter:creator content="@novoreorx"><meta property="og:title" content><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://livypad.github.io accesskey=h title="zhh's blog (Alt + H)">zhh's blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://livypad.github.io/about/ title=About>About</a></li><li><a href=https://livypad.github.io/tags/ title=Tags>Tags</a></li><li><a href=https://livypad.github.io/archives/ title=Archive>Archive</a></li><li><a href=https://livypad.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ title=Note>Note</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://livypad.github.io>Home</a>&nbsp;»&nbsp;<a href=https://livypad.github.io/post/>Posts</a></div><h1 class=post-title>笔记：Distributed Systems An Algorithmic Approach 2nd</h1><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2022-07-09</span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<a href=https://livypad.github.io/tags/%E6%95%99%E7%A8%8B/>教程 </a><a href=https://livypad.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/>读书笔记</a>
</span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>4136 words</span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>9 min</span></span></div></header><div class="toc side left"><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#ghosh-sukumar-2014---distributed-systems-an-algorithmic-approach aria-label="Ghosh, Sukumar (2014) - Distributed Systems An Algorithmic Approach">Ghosh, Sukumar (2014) - Distributed Systems An Algorithmic Approach</a><ul><li><a href=#ch-1-introduction aria-label="Ch 1 introduction">Ch 1 introduction</a></li><li><a href=#ch-2-interprocess-communication aria-label="Ch 2 interprocess communication">Ch 2 interprocess communication</a><ul><li><a href=#naming aria-label=naming>naming</a></li><li><a href=#rpc-remote-procedure-call aria-label="rpc remote procedure call">rpc remote procedure call</a></li><li><a href=#cloud-computing aria-label="cloud computing">cloud computing</a><ul><li><a href=#mapreduce aria-label=MapReduce>MapReduce</a></li></ul></li></ul></li><li><a href=#ch-3-models-for-communication aria-label="ch 3 Models for Communication">ch 3 Models for Communication</a><ul><li><a href=#shared-variable-%e5%85%b1%e4%ba%ab%e5%8f%98%e9%87%8f aria-label="shared variable 共享变量">shared variable 共享变量</a><ul><li><a href=#linda aria-label=linda>linda</a></li><li><a href=#mobile-agent aria-label="mobile agent">mobile agent</a></li></ul></li><li><a href=#%e6%a8%a1%e5%9e%8b%e5%bc%ba%e5%bc%b1 aria-label=模型强弱>模型强弱</a><ul><li><a href=#resequencing-protocol-%e9%9d%9e-fifo-%e6%a8%a1%e6%8b%9f-fifo aria-label="resequencing protocol, 非 FIFO 模拟 FIFO">resequencing protocol, 非 FIFO 模拟 FIFO</a></li><li><a href=#%e5%85%b1%e4%ba%ab%e5%8f%98%e9%87%8f%e6%a8%a1%e6%8b%9f%e4%bf%a1%e6%81%af%e4%bc%a0%e9%80%92 aria-label=共享变量模拟信息传递>共享变量模拟信息传递</a></li><li><a href=#%e4%bf%a1%e6%81%af%e4%bc%a0%e9%80%92%e6%a8%a1%e6%8b%9f%e5%85%b1%e4%ba%ab%e5%8f%98%e9%87%8f aria-label=信息传递模拟共享变量>信息传递模拟共享变量</a></li><li><a href=#%e4%bf%a1%e9%81%93%e5%88%a4%e7%a9%ba%e7%9a%84%e4%b8%8d%e5%8f%af%e8%83%bd%e6%80%a7 aria-label=信道判空的不可能性>信道判空的不可能性</a></li></ul></li><li><a href=#%e7%b3%bb%e7%bb%9f%e5%88%86%e7%b1%bb aria-label=系统分类>系统分类</a></li><li><a href=#%e5%a4%8d%e6%9d%82%e5%ba%a6%e8%ae%a1%e6%95%b0 aria-label=复杂度计数>复杂度计数</a></li></ul></li><li><a href=#ch-4-representing-distributed-algorithms aria-label="ch 4 Representing Distributed Algorithms">ch 4 Representing Distributed Algorithms</a><ul><li><a href=#%e5%85%ac%e6%ad%a3%e6%80%a7 aria-label=公正性>公正性</a></li><li><a href=#scheduler aria-label=scheduler>scheduler</a></li></ul></li><li><a href=#ch-5-program-correctness aria-label="ch 5 Program Correctness">ch 5 Program Correctness</a><ul><li><a href=#%e6%96%ad%e8%a8%80%e6%8e%a8%e7%90%86-assertional-reasoning aria-label="断言推理 assertional reasoning">断言推理 assertional reasoning</a></li><li><a href=#%e8%89%af%e5%9f%ba%e9%9b%86-well-founeded-set aria-label="良基集 well-founeded set">良基集 well-founeded set</a></li><li><a href=#%e6%97%b6%e9%97%b4%e9%80%bb%e8%be%91-temporal-logic aria-label="时间逻辑 temporal logic">时间逻辑 temporal logic</a></li></ul></li><li><a href=#ch-6-time-in-a-distributed-system aria-label="ch 6 Time in a Distributed System">ch 6 Time in a Distributed System</a><ul><li><a href=#%e9%80%bb%e8%be%91%e6%97%b6%e9%92%9f aria-label=逻辑时钟>逻辑时钟</a><ul><li><a href=#%e5%bc%b1%e6%97%b6%e9%92%9f%e6%9d%a1%e4%bb%b6-%e5%81%8f%e5%ba%8f%e5%85%b3%e7%b3%bb-prec aria-label="弱时钟条件 偏序关系 $\prec$">弱时钟条件 偏序关系 $\prec$</a></li><li><a href=#%e5%bc%b1%e6%97%b6%e9%92%9f%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%80%bb%e8%be%91%e6%97%b6%e9%92%9f-logic-clock aria-label="弱时钟实现的逻辑时钟 logic clock">弱时钟实现的逻辑时钟 logic clock</a></li><li><a href=#%e5%bc%ba%e6%97%b6%e9%92%9f%e5%85%b3%e7%b3%bb-%e5%85%a8%e5%ba%8f%e5%85%b3%e7%b3%bb-ll aria-label="强时钟关系 全序关系 $\ll$">强时钟关系 全序关系 $\ll$</a></li></ul></li><li><a href=#%e5%90%91%e9%87%8f%e6%97%b6%e9%92%9f-vector-clock aria-label="向量时钟 vector clock">向量时钟 vector clock</a></li><li><a href=#%e7%89%a9%e7%90%86%e6%97%b6%e9%92%9f%e5%90%8c%e6%ad%a5 aria-label=物理时钟同步>物理时钟同步</a><ul><li><a href=#berkeley-%e7%ae%97%e6%b3%95-%e5%86%85%e9%83%a8%e5%90%8c%e6%ad%a5 aria-label="Berkeley 算法 内部同步">Berkeley 算法 内部同步</a></li><li><a href=#lamport-and-melliarsmith-%e7%ae%97%e6%b3%95-%e5%86%85%e9%83%a8%e5%90%8c%e6%ad%a5 aria-label="Lamport and Melliar–Smith 算法 内部同步">Lamport and Melliar–Smith 算法 内部同步</a></li><li><a href=#cristian-%e7%ae%97%e6%b3%95-%e5%a4%96%e9%83%a8%e5%90%8c%e6%ad%a5 aria-label="Cristian 算法 外部同步">Cristian 算法 外部同步</a></li><li><a href=#ntp-network-time-protocol-%e5%ae%9e%e7%8e%b0 aria-label="NTP network time protocol 实现">NTP network time protocol 实现</a></li></ul></li></ul></li></ul></li></ul></div></details></div><div class=post-content><ul><li><a href=#ghosh-sukumar-2014---distributed-systems-an-algorithmic-approach>Ghosh, Sukumar (2014) - Distributed Systems An Algorithmic Approach</a><ul><li><a href=#ch-1-introduction>Ch 1 introduction</a></li><li><a href=#ch-2-interprocess-communication>Ch 2 interprocess communication</a><ul><li><a href=#naming>naming</a></li><li><a href=#rpc-remote-procedure-call>rpc remote procedure call</a></li><li><a href=#cloud-computing>cloud computing</a><ul><li><a href=#mapreduce>MapReduce</a></li></ul></li></ul></li><li><a href=#ch-3-models-for-communication>ch 3 Models for Communication</a><ul><li><a href=#shared-variable-%E5%85%B1%E4%BA%AB%E5%8F%98%E9%87%8F>shared variable 共享变量</a><ul><li><a href=#linda>linda</a></li><li><a href=#mobile-agent>mobile agent</a></li></ul></li><li><a href=#%E6%A8%A1%E5%9E%8B%E5%BC%BA%E5%BC%B1>模型强弱</a><ul><li><a href=#resequencing-protocol-%E9%9D%9E-fifo-%E6%A8%A1%E6%8B%9F-fifo>resequencing protocol, 非 FIFO 模拟 FIFO</a></li><li><a href=#%E5%85%B1%E4%BA%AB%E5%8F%98%E9%87%8F%E6%A8%A1%E6%8B%9F%E4%BF%A1%E6%81%AF%E4%BC%A0%E9%80%92>共享变量模拟信息传递</a></li><li><a href=#%E4%BF%A1%E6%81%AF%E4%BC%A0%E9%80%92%E6%A8%A1%E6%8B%9F%E5%85%B1%E4%BA%AB%E5%8F%98%E9%87%8F>信息传递模拟共享变量</a></li><li><a href=#%E4%BF%A1%E9%81%93%E5%88%A4%E7%A9%BA%E7%9A%84%E4%B8%8D%E5%8F%AF%E8%83%BD%E6%80%A7>信道判空的不可能性</a></li></ul></li><li><a href=#%E7%B3%BB%E7%BB%9F%E5%88%86%E7%B1%BB>系统分类</a></li><li><a href=#%E5%A4%8D%E6%9D%82%E5%BA%A6%E8%AE%A1%E6%95%B0>复杂度计数</a></li></ul></li><li><a href=#ch-4-representing-distributed-algorithms>ch 4 Representing Distributed Algorithms</a><ul><li><a href=#%E5%85%AC%E6%AD%A3%E6%80%A7>公正性</a></li><li><a href=#scheduler>scheduler</a></li></ul></li><li><a href=#ch-5-program-correctness>ch 5 Program Correctness</a><ul><li><a href=#%E6%96%AD%E8%A8%80%E6%8E%A8%E7%90%86-assertional-reasoning>断言推理 assertional reasoning</a></li><li><a href=#%E8%89%AF%E5%9F%BA%E9%9B%86-well-founeded-set>良基集 well-founeded set</a></li><li><a href=#%E6%97%B6%E9%97%B4%E9%80%BB%E8%BE%91-temporal-logic>时间逻辑 temporal logic</a></li></ul></li><li><a href=#ch-6-time-in-a-distributed-system>ch 6 Time in a Distributed System</a><ul><li><a href=#%E9%80%BB%E8%BE%91%E6%97%B6%E9%92%9F>逻辑时钟</a><ul><li><a href=#%E5%BC%B1%E6%97%B6%E9%92%9F%E6%9D%A1%E4%BB%B6-%E5%81%8F%E5%BA%8F%E5%85%B3%E7%B3%BB-prec>弱时钟条件 偏序关系 $\prec$</a></li><li><a href=#%E5%BC%B1%E6%97%B6%E9%92%9F%E5%AE%9E%E7%8E%B0%E7%9A%84%E9%80%BB%E8%BE%91%E6%97%B6%E9%92%9F-logic-clock>弱时钟实现的逻辑时钟 logic clock</a></li><li><a href=#%E5%BC%BA%E6%97%B6%E9%92%9F%E5%85%B3%E7%B3%BB-%E5%85%A8%E5%BA%8F%E5%85%B3%E7%B3%BB-ll>强时钟关系 全序关系 $\ll$</a></li></ul></li><li><a href=#%E5%90%91%E9%87%8F%E6%97%B6%E9%92%9F-vector-clock>向量时钟 vector clock</a></li><li><a href=#%E7%89%A9%E7%90%86%E6%97%B6%E9%92%9F%E5%90%8C%E6%AD%A5>物理时钟同步</a><ul><li><a href=#berkeley-%E7%AE%97%E6%B3%95-%E5%86%85%E9%83%A8%E5%90%8C%E6%AD%A5>Berkeley 算法 内部同步</a></li><li><a href=#lamport-and-melliarsmith-%E7%AE%97%E6%B3%95-%E5%86%85%E9%83%A8%E5%90%8C%E6%AD%A5>Lamport and Melliar–Smith 算法 内部同步</a></li><li><a href=#cristian-%E7%AE%97%E6%B3%95-%E5%A4%96%E9%83%A8%E5%90%8C%E6%AD%A5>Cristian 算法 外部同步</a></li><li><a href=#ntp-network-time-protocol-%E5%AE%9E%E7%8E%B0>NTP network time protocol 实现</a></li></ul></li></ul></li></ul></li></ul><h1 id=ghosh-sukumar-2014---distributed-systems-an-algorithmic-approach>Ghosh, Sukumar (2014) - Distributed Systems An Algorithmic Approach<a hidden class=anchor aria-hidden=true href=#ghosh-sukumar-2014---distributed-systems-an-algorithmic-approach>¶</a></h1><h2 id=ch-1-introduction>Ch 1 introduction<a hidden class=anchor aria-hidden=true href=#ch-1-introduction>¶</a></h2><p>特征</p><ol><li>多进程</li><li>进程间通讯</li><li>分离地址空间</li><li>单任务</li></ol><p>使用分布式的原因</p><ul><li>地理分离</li><li>加速</li><li>远端资源共享</li><li>容错</li></ul><p>一般的问题</p><ol><li>leader 选举</li><li>互斥</li><li>时钟同步</li><li>全局状态</li><li>组播</li><li>副本管理</li></ol><h2 id=ch-2-interprocess-communication>Ch 2 interprocess communication<a hidden class=anchor aria-hidden=true href=#ch-2-interprocess-communication>¶</a></h2><h3 id=naming>naming<a hidden class=anchor aria-hidden=true href=#naming>¶</a></h3><p>位置无关，方便定位实体。一般是文本形式，树状结构</p><h3 id=rpc-remote-procedure-call>rpc remote procedure call<a hidden class=anchor aria-hidden=true href=#rpc-remote-procedure-call>¶</a></h3><ul><li>机器差异（大小端，指针和地址）</li><li>阻塞/非阻塞</li><li>丢包：at-least-once/at-most-once,exactly once</li></ul><table><thead><tr><th>Client Stub</th><th>Server Stub</th></tr></thead><tbody><tr><td>Pack parameters into a message，Send message to remote machine</td><td>Do no message → skip od ，Unpack the call parameters</td></tr><tr><td>Do no result → skip od*，Receive result and unpack it</td><td>Call the server procedure Receive result and unpack it Pack result into a message</td></tr><tr><td>Return to the client program</td><td>Send it to the client</td></tr></tbody></table><h3 id=cloud-computing>cloud computing<a hidden class=anchor aria-hidden=true href=#cloud-computing>¶</a></h3><ul><li>software-as-a-service, SaaS<ul><li>Google doc，云盘等</li></ul></li><li>platform-as-a-service, PaaS<ul><li>小程序 API（？</li></ul></li><li>infrastructure-as-a-service, IaaS<ul><li>elastic computing cloud， EC2 云服务器</li></ul></li></ul><h4 id=mapreduce>MapReduce<a hidden class=anchor aria-hidden=true href=#mapreduce>¶</a></h4><p>Map: 〈<em>key, value</em>〉→ list of 〈<em>key, value</em>〉</p><p>{This is the intermediate 〈key, value〉 pair}</p><p>Reduce: 〈<em>key, list of values</em>〉 → list of 〈<em>key, value</em>〉</p><h2 id=ch-3-models-for-communication>ch 3 Models for Communication<a hidden class=anchor aria-hidden=true href=#ch-3-models-for-communication>¶</a></h2><blockquote><p>本书的可靠信道公理 channel</p><ol><li>所有发出消息都被接收方收到，所有收到消息都有发送者<ul><li>对数据链路/传输层不适用，需要恢复</li></ul></li><li>每条信息都有一条任意，有限长，非零延迟<ul><li>为了放宽对不同延迟的支持</li></ul></li><li>信道呈现 FIFO 特性<ul><li>电报 datagram 网络乱序</li></ul></li></ol></blockquote><h3 id=shared-variable-共享变量>shared variable 共享变量<a hidden class=anchor aria-hidden=true href=#shared-variable-共享变量>¶</a></h3><blockquote><p>DSM</p><p>distribted shared memory，方便使用共享变量有关的编程工具</p></blockquote><ol><li>state reading/locally shared variable 读取自身和邻居状态，只能修改自己状态</li><li>link register 链路自带单读者单写者寄存器</li></ol><h4 id=linda>linda<a hidden class=anchor aria-hidden=true href=#linda>¶</a></h4><p>共享的 tuple space</p><table><thead><tr><th>原语</th><th>含义</th></tr></thead><tbody><tr><td>IN，INP</td><td>取出 tuple，分阻塞、非阻塞版本</td></tr><tr><td>OUT</td><td>放入 tuple</td></tr><tr><td>RD，RDP</td><td>读 tuple，类比 in 不删除。分阻塞、非阻塞版本</td></tr><tr><td>EVAL</td><td>创建新进程</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cm>/** main program**/</span>
</span></span><span class=line><span class=cl><span class=n>real_main</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span><span class=n>argv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>argc</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[];</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>nslave</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>hello</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>nslave</span> <span class=o>=</span> <span class=n>atoi</span> <span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>nslave</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    	<span class=n>EVAL</span> <span class=p>(</span><span class=s>&#34;slave&#34;</span><span class=p>,</span> <span class=n>hello</span><span class=p>(</span><span class=n>j</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>nslave</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    	<span class=n>IN</span><span class=p>(</span><span class=s>&#34;done&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;Task completed.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/** subroutine hello **/</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>hello</span> <span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;Task from number %d.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>OUT</span><span class=p>(</span><span class=s>&#34;done&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=mobile-agent>mobile agent<a hidden class=anchor aria-hidden=true href=#mobile-agent>¶</a></h4><p>移动执行的代码</p><p>(I, P, B)</p><ul><li>I 标识符</li><li>P 对应代码</li><li>B 代码的变量</li></ul><h3 id=模型强弱>模型强弱<a hidden class=anchor aria-hidden=true href=#模型强弱>¶</a></h3><p>强模型限制多，操作多；强模型模拟弱模型容易，反之可能困难</p><h4 id=resequencing-protocol-非-fifo-模拟-fifo>resequencing protocol, 非 FIFO 模拟 FIFO<a hidden class=anchor aria-hidden=true href=#resequencing-protocol-非-fifo-模拟-fifo>¶</a></h4><p>缓存再发送。可以优化为环形缓存编号</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>{Sender process P}
</span></span><span class=line><span class=cl>var i : integer {initially 0}
</span></span><span class=line><span class=cl>repeat
</span></span><span class=line><span class=cl>    send m[i],i to Q;
</span></span><span class=line><span class=cl>    i := i+1;
</span></span><span class=line><span class=cl>forever
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{Receiver process Q}
</span></span><span class=line><span class=cl>var k : integer {initially 0}
</span></span><span class=line><span class=cl>buffer : buffer [0..∞] of message
</span></span><span class=line><span class=cl>{initially for all k:buffer[k] = null}
</span></span><span class=line><span class=cl>repeat{store}
</span></span><span class=line><span class=cl>	receive m[i],i from P;
</span></span><span class=line><span class=cl>    store m[i] into buffer[i];
</span></span><span class=line><span class=cl>    {deliver}
</span></span><span class=line><span class=cl>    while buffer[k] ≠ null do
</span></span><span class=line><span class=cl>    begin
</span></span><span class=line><span class=cl>        deliver the content of buffer [k];
</span></span><span class=line><span class=cl>        buffer [k] := null; k := k+1;
</span></span><span class=line><span class=cl>    end
</span></span><span class=line><span class=cl>forever
</span></span></code></pre></td></tr></table></div></div><h4 id=共享变量模拟信息传递>共享变量模拟信息传递<a hidden class=anchor aria-hidden=true href=#共享变量模拟信息传递>¶</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>shared var p, q: integer {initially p = q}
</span></span><span class=line><span class=cl>buffer: array [0..max-1] of message
</span></span><span class=line><span class=cl>{Sender process P}
</span></span><span class=line><span class=cl>var s: array of messages sent by P, i : integer {initially 0}
</span></span><span class=line><span class=cl>repeat
</span></span><span class=line><span class=cl>	if p ≠ q − 1 mod max then
</span></span><span class=line><span class=cl>    begin
</span></span><span class=line><span class=cl>    	buffer[p] := s[i]; i := i + 1; p := p + 1 mod max
</span></span><span class=line><span class=cl>    end
</span></span><span class=line><span class=cl>forever
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{Receiver process Q}
</span></span><span class=line><span class=cl>var r: array of messages received by Q, j : integer {initially 0}
</span></span><span class=line><span class=cl>repeat
</span></span><span class=line><span class=cl>    if q ≠ p mod max then
</span></span><span class=line><span class=cl>    begin
</span></span><span class=line><span class=cl>    	r[j] := buffer[q]; j := j + 1; q := q + 1 mod max
</span></span><span class=line><span class=cl>    end
</span></span><span class=line><span class=cl>forever
</span></span></code></pre></td></tr></table></div></div><h4 id=信息传递模拟共享变量>信息传递模拟共享变量<a hidden class=anchor aria-hidden=true href=#信息传递模拟共享变量>¶</a></h4><p>下列实现错误：</p><ol><li>组播不 atmoic，atmoic 组播有代价</li><li>组播不一定遵循更新变量顺序</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>{Implementing shared memory by message passing: first attempt}
</span></span><span class=line><span class=cl>{read X by process i}
</span></span><span class=line><span class=cl>read x[i] x[i] := v
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{write X := v by process i}
</span></span><span class=line><span class=cl>x[i] := v
</span></span><span class=line><span class=cl>Multicast v to every other process j (j ≠ i) in the system;
</span></span><span class=line><span class=cl>Process j (j ≠ i), after receiving the multicast, sets x[j] to v.
</span></span></code></pre></td></tr></table></div></div><h4 id=信道判空的不可能性>信道判空的不可能性<a hidden class=anchor aria-hidden=true href=#信道判空的不可能性>¶</a></h4><p>如果进程<code>i,j</code>之间信道需要判空</p><ul><li>已知<code>i,j</code>之间最大时延 T，等待 T</li><li>未知最大时延，初始信道可以包含任意信息，无法判空（即使使用一个清零帧）</li></ul><h3 id=系统分类>系统分类<a hidden class=anchor aria-hidden=true href=#系统分类>¶</a></h3><ul><li>reactive：反应性，对请求响应</li><li>transformational：转移性，存在初态和末态</li><li>named：和处理器标识有关</li><li>anonymous：和处理器标识无关，即使标识改变可以继续运行，需要如随机数等机制打破对称性</li></ul><h3 id=复杂度计数>复杂度计数<a hidden class=anchor aria-hidden=true href=#复杂度计数>¶</a></h3><ul><li>空间复杂度：按 node 数目的增长要求的空间</li><li>时间复杂度<ul><li>总步数</li><li>总轮次 round：最远端的执行一次是一轮</li></ul></li></ul><h2 id=ch-4-representing-distributed-algorithms>ch 4 Representing Distributed Algorithms<a hidden class=anchor aria-hidden=true href=#ch-4-representing-distributed-algorithms>¶</a></h2><blockquote><p>guard</p><p>断言，条件执行，如果多个断言判正确，由 scheduler 决定执行任意一个代码段，下面假定每个代码段原子执行</p></blockquote><p>程序终止条件</p><ol><li>每个进程终止，guard 全判<code>false</code></li><li>无消息还在传递</li></ol><p>类似如下的伪代码和对应的 Rust 实现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>program uncertain;
</span></span><span class=line><span class=cl>define x : integer;
</span></span><span class=line><span class=cl>initially x = 0
</span></span><span class=line><span class=cl>do
</span></span><span class=line><span class=cl>  x &lt; 4 → x := x + 1
</span></span><span class=line><span class=cl>  [] x = 3 → x := 0
</span></span><span class=line><span class=cl>od
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>rand</span>::<span class=n>Rng</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>sync</span>::<span class=n>atomic</span>::<span class=p>{</span><span class=n>AtomicUsize</span><span class=p>,</span><span class=w> </span><span class=n>Ordering</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>static</span><span class=w> </span><span class=n>CNT</span>: <span class=nc>AtomicUsize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AtomicUsize</span>::<span class=n>new</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=mi>10</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CNT</span><span class=p>.</span><span class=n>store</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>Ordering</span>::<span class=n>Relaxed</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>the</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>the</span><span class=p>(</span><span class=n>i</span>: <span class=kt>i32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CNT</span><span class=p>.</span><span class=n>fetch_add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>Ordering</span>::<span class=n>Relaxed</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>4</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=n>_</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>guess</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rand</span>::<span class=n>thread_rng</span><span class=p>().</span><span class=n>gen_range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>100</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>match</span><span class=w> </span><span class=n>guess</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=mi>0</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>the</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>the</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>the</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;terminate in {:?}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>CNT</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=公正性>公正性<a hidden class=anchor aria-hidden=true href=#公正性>¶</a></h3><p>由于 guarded action 的选择依赖 scheduler （调度器） 决定，scheduler 需要考虑公平性</p><ul><li>无条件公平：每个代码段最终会进入调度队列，无论 guard 值</li><li>弱公平：只要代码段的 guard 变为并保持 <code>true</code>就最终会进入调度队列</li><li>强公平：只要代码段的 guard 能无限次经常变为<code>true</code>就最终会进入调度队列，弱公平能跑出的顺序，强公平一定能跑出，反之不一定</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>program test
</span></span><span class=line><span class=cl>define
</span></span><span class=line><span class=cl>x: integer {initial value undefined}
</span></span><span class=line><span class=cl>do
</span></span><span class=line><span class=cl>  true → x := 0
</span></span><span class=line><span class=cl>  [] x = 0 → x := 1
</span></span><span class=line><span class=cl>  [] x = 1 → x := 2
</span></span><span class=line><span class=cl>od
</span></span></code></pre></td></tr></table></div></div><ul><li>不公平时可能只执行第 1 条</li><li>弱公平时只保证执行第 1、2 条（一直执行第 1 条会保证 x=0 从而执行 2，但 x=1 时可以只执行第 1 条而使得第 3 条永不满足）</li></ul><h3 id=scheduler>scheduler<a hidden class=anchor aria-hidden=true href=#scheduler>¶</a></h3><blockquote><p>central scheduler</p><p>又名 serial scheduler：原子的调度执行 guard 对应的代码段，简单，可以用 token 传递实现，拓展性差，并行度差，是分布式 scheduler 的退化情形</p><p>有关的 Theorem：</p><ol><li>算法在 central scheduler 下正确</li><li>已为<code>true</code> 的 guard 不会被其他代码段修改为<code>false</code></li></ol><p>=>在 distributed scheduler 下正确</p></blockquote><h2 id=ch-5-program-correctness>ch 5 Program Correctness<a hidden class=anchor aria-hidden=true href=#ch-5-program-correctness>¶</a></h2><blockquote><p>安全 safety 条件</p><p>&ldquo;bad things never happen.&rdquo;</p></blockquote><p>如：</p><ul><li>同步互斥：至多一个进程在临界区</li><li>有限容量信道：$nC\le nP\le nC+B$</li><li>读写锁：$(nW\le 1 \wedge nR=0) \vee (nW=0\wedge nR\ge 0)$</li><li>无死锁：$Q\wedge GG$</li><li>部分正确性：如果不死锁，必得正确结果 $\neg GG\implies Q$</li></ul><blockquote><p>活跃 liveness 条件</p><p>&ldquo;good things eventually happen.&rdquo;</p></blockquote><p>如：</p><ul><li>进行：对于同步互斥问题，不死锁，不活锁（声明了临界区，最终总能获得机会）</li><li>公平性：有限时间后 schduler 总会调度</li><li>可达性：是否可以从初始状态 $S_0$ 到达状态 $S_k$</li><li>终止：部分正确+终止状态可达</li></ul><h3 id=断言推理-assertional-reasoning>断言推理 assertional reasoning<a hidden class=anchor aria-hidden=true href=#断言推理-assertional-reasoning>¶</a></h3><p>用于证明安全性。构造不变式 $I$ 代表安全性条件（类似数学归纳法）</p><ol><li>初态不变式 $I$满足</li><li>假定前状态不变式 $I$满足，任何执行后不变式 $I$ 仍然满足</li></ol><h3 id=良基集-well-founeded-set>良基集 well-founeded set<a hidden class=anchor aria-hidden=true href=#良基集-well-founeded-set>¶</a></h3><p>用于证明活跃性。一个映射（测量函数/变化函数 measured/variant function）从系统全局状态到一个 well-founed set $f:S\to WF$</p><blockquote><p>well-founded set</p><p>对于 $WF={w_1,w_2,&mldr;}$ ，上面有个全序关系$\gg$</p><ol><li>不存在无穷比较链 $w_1\gg w_2 \gg &mldr;$</li><li>系统状态从 $s_1$ 到 $s_2$ ，有 $w_1=f(s_1),w_2=f(s_2) \implies w_1 \gg w_2$</li></ol></blockquote><p>一般 well-founed set 会选择非负整数集，0 就是终止状态，全序关系就是大于；也有选择 set 是一组元素，全序关系是字典顺序。</p><h3 id=时间逻辑-temporal-logic>时间逻辑 temporal logic<a hidden class=anchor aria-hidden=true href=#时间逻辑-temporal-logic>¶</a></h3><ul><li>$\Box P$ 意思是 $P$ 永真</li><li>$\lozenge P$ 意思是 $P$ 最终会变为真</li></ul><p>有</p><ol><li>$\lozenge P=\neg \Box (\neg P)$：P 假不是一直不真的=P 假最终会不真</li><li>$\Box P\wedge \Box Q=\Box (P\wedge Q)$</li><li>$\Box P\vee \Box Q=\Box (P\vee Q)$</li><li>$\lozenge\Box P\implies \Box \lozenge P$：P 最终会一直真推出 P 会一直经常真（强公平蕴含弱公平）</li><li>$\lozenge P\wedge \lozenge Q=\lozenge (P\wedge Q)$</li><li>$\lozenge P\vee \lozenge Q=\lozenge (P\vee Q)$</li><li>$\lozenge P\vee Q\neq \lozenge (P\vee Q)$: <strong>注意：</strong> 如果 $Q=\neg P$，右边永真，左边可以为假</li></ol><h2 id=ch-6-time-in-a-distributed-system>ch 6 Time in a Distributed System<a hidden class=anchor aria-hidden=true href=#ch-6-time-in-a-distributed-system>¶</a></h2><h3 id=逻辑时钟>逻辑时钟<a hidden class=anchor aria-hidden=true href=#逻辑时钟>¶</a></h3><h4 id=弱时钟条件-偏序关系-prec>弱时钟条件 偏序关系 $\prec$<a hidden class=anchor aria-hidden=true href=#弱时钟条件-偏序关系-prec>¶</a></h4><ol><li>同一进程里，a 在 b 后发生，$a\prec b$</li><li>两个进程通讯，i 进程的 a 发送，j 进程 b 接受，$a\prec b$</li><li>$(a\prec b)\wedge(b\prec c)\implies (a\prec c)$</li></ol><h4 id=弱时钟实现的逻辑时钟-logic-clock>弱时钟实现的逻辑时钟 logic clock<a hidden class=anchor aria-hidden=true href=#弱时钟实现的逻辑时钟-logic-clock>¶</a></h4><ol><li>每个本地事件发生，$LC$ 递增 1</li><li>发送消息时附上当前 $LC$ 作为时间戳</li><li>接受到消息时 $LC=1+\max(local; LC, message; LC)$</li></ol><p>此时可以保证，但是反之不成立。逻辑时钟不能完全和因果关系互推，需要<a href=#%E5%90%91%E9%87%8F%E6%97%B6%E9%92%9F-vector-clock>向量时钟</a>。</p><p>$a\prec b\implies LC(a)&lt;LC(b)$</p><h4 id=强时钟关系-全序关系-ll>强时钟关系 全序关系 $\ll$<a hidden class=anchor aria-hidden=true href=#强时钟关系-全序关系-ll>¶</a></h4><p>$a\ll b$ 成立条件</p><ul><li>要么$LC(a)&lt;LC(b)$</li><li>要么不同进程，事件 a、b 对应进程 i、j，有 $LC(a)=LC(b),i&lt;j$</li></ul><h3 id=向量时钟-vector-clock>向量时钟 vector clock<a hidden class=anchor aria-hidden=true href=#向量时钟-vector-clock>¶</a></h3><p>从事件集到进程数大小(假定为 n)的非负整数向量的函数 $VC:V\to A$。事件 a、b 的向量时钟之间大小关系$VC(a)&lt;VC(b)$的充要条件为</p><ol><li>$\forall i:i\in [0,n-1]:VC_i(a)\le VC_i(b)$</li><li>$\exists j\in[0,n-1]:VC_j(a)&lt;VC_j(b)$</li></ol><p>如果两个事件之间向量时钟既不大于也不小于，认为事件同时，记作$a\parallel b$。向量时钟保证了因果检测，即 $a\prec b \iff VC(a)&lt;VC(b)$ 。实现要求：</p><ol><li>进程 i 本地事件发生时候 $VC_i[i]+=1$</li><li>发送信息时附带整个向量时钟</li><li>进程 j 收到消息附带时间戳 $T$ 时，先更新本地 $VC_j[j]+=1$ ，再更新全局 $\forall k \in [0,n-1]:VC_k[j]=\max(T_k,VC_k[j])$</li></ol><h3 id=物理时钟同步>物理时钟同步<a hidden class=anchor aria-hidden=true href=#物理时钟同步>¶</a></h3><ol><li>外部时钟同步：和 UTC/原子钟/GPS 同步时间。可以借助 NTP（network time protocol）协议</li><li>内部时钟同步：在即使内部少数错误时钟下仍然同步时间，只需要内部相互同步即可，注意一般通过调快/调慢实现以防止突变</li><li>相同步</li><li>有界时钟：只能通过加位数保证可预见未来不溢出</li></ol><ul><li>偏移率 drift rate：内部时钟和理想时钟走时速度不完全相等：$(1-\rho)\le \frac{\rm{d}C}{\rm{d}t}\le(1+\rho)$</li><li>时钟偏差 clock skew：时钟之间最大允许读数偏差 $\delta$</li><li>重同步间隔 resynchronization interval ：$R$</li></ul><h4 id=berkeley-算法-内部同步>Berkeley 算法 内部同步<a hidden class=anchor aria-hidden=true href=#berkeley-算法-内部同步>¶</a></h4><p>选择一个 leader 收集计算各个内部时钟的平均值，并按此调整</p><h4 id=lamport-and-melliarsmith-算法-内部同步>Lamport and Melliar–Smith 算法 内部同步<a hidden class=anchor aria-hidden=true href=#lamport-and-melliarsmith-算法-内部同步>¶</a></h4><p>可以应对 two-faced clock（2 个非错时钟向 two-faced 时钟读数结果不一致）问题。$c_k[i]$ 表示时钟 i 读取时钟 k 得到的值。</p><ol><li>读系统中每个时钟的值</li><li>将离群值丢弃,用本地值代替： $|c_i[i]-c_j[i]|>\delta \implies c_j[i]\gets c_i[i]$</li><li>使用处理后的平均值覆盖本地时钟值</li></ol><p>对于 n 个时钟，只要 two-faced clock 数目 t 有 $n>3t$ 就能保证同步。</p><p>考虑 3 个时钟，i、j 好，k 为 two-faced clock。有如下配置</p><ul><li>$c_i[i]=c$</li><li>$c_j[j]=c-\delta$</li><li>$c_k[i]=c+\delta$</li><li>$c_k[j]=c-2\delta$</li></ul><p>这时候 i、j 平均值差为 $\frac{3t\delta}{n}$。如果 $n>3t$ 就有$\frac{3t\delta}{n}&lt;\delta$。同步间隔 $R\le(\delta -\frac{3t\delta}{n})/\rho$</p><h4 id=cristian-算法-外部同步>Cristian 算法 外部同步<a hidden class=anchor aria-hidden=true href=#cristian-算法-外部同步>¶</a></h4><p>每个 client 向有精确时钟的 time server 定时通信来同步时钟： $R&lt;\frac{\delta}{2\rho}$。</p><blockquote><p>round-trip time</p><p>每次同步通过发起 RPC，用来度量信号延迟：$RTT=T_2-T_1$</p></blockquote><p>每次时钟修正为 $T_s+\frac{RTT}{2}=T_s+\frac{T_2-T_1}{2}$。但实际网络波动，返回时间是一个区间，记最短用时 $min$，对应同步精度 $\pm(\frac{T_2-T_1}{2}-min)$</p><h4 id=ntp-network-time-protocol-实现>NTP network time protocol 实现<a hidden class=anchor aria-hidden=true href=#ntp-network-time-protocol-实现>¶</a></h4><p>按层级 stratum 组织各计算机，stratum 0 对应直连高精度时钟，stratum $i$ 作为 $i+1$ 的 time server，精度随着层级增加递减。</p><ul><li>组播：使用 UDP 协议定期发送</li><li>RPC：使用 <a href=#cristian-%E7%AE%97%E6%B3%95-%E5%A4%96%E9%83%A8%E5%90%8C%E6%AD%A5>Cristian 算法</a></li><li>P2P 通信：同层级的 time server 互相同步保持精度。设 Q 在 P 之前$\delta$，互相发报：$T_2=T_1+T_{PQ}+\delta,T_4=t_3+T_{QP}-\delta$，则有 $\delta=\frac{T_2-T_4-T_1+T_3}{2}-\frac{T_{PQ}-T_{QP}}{2},RTT=T_{PQ}+T_{QP}=T_2+T_4-T_1-T_3$， 这时候两个时钟误差$\delta$就可以控制在 $\frac{T_2-T_4-T_1+T_3}{2}\pm\frac{RTT}{2}$ 里面（注意到 $T_{PQ},T_{QP}>0$，相减的值可以由 RTT 控制）</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://livypad.github.io/tags/%E6%95%99%E7%A8%8B/>教程</a></li><li><a href=https://livypad.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/>读书笔记</a></li></ul><nav class=paginav><a class=next href=https://livypad.github.io/post/2022-06-21-fairytalerabbit/><span class=title>Next Page »</span><br><span>遥远的时间有关的童话/寓言（？</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://livypad.github.io>zhh's blog</a></span><span style=display:inline-block;margin-left:1em>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$']],
            displayMath: [['$$','$$']],
            processEscapes: true,
            processEnvironments: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            TeX: { equationNumbers: { autoNumber: "AMS" },
                 extensions: ["AMSmath.js", "AMSsymbols.js"] }
          }
        });
    </script><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script>
<script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const r="1"=="1";if(!r)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const c=window.scrollListeners,n=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),s="active";let e=n[0];o(e).classList.add(s);const a=()=>{const t=[];for(const e of n)if(l(e)<5)t.push(e);else break;t.length>0?newActiveHeading=t[t.length-1]:newActiveHeading=n[0],e!=newActiveHeading&&(o(e).classList.remove(s),e=newActiveHeading,o(e).classList.add(s))};let t=null;const i=()=>{t!==null&&clearTimeout(t),t=setTimeout(a,50)};window.addEventListener("scroll",i,!1),c.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>